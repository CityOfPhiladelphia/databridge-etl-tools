sudo: required #is required to use docker service in travis

language: generic

services:
  - docker # required, but travis uses older version of docker :(

git:
  submodules:
    false
    
before_install:
  - echo -e "\n\nmachine github.com\n  $CI_TOKEN\n" >~/.netrc
  - git submodule update --init --recursive

script:
  - echo "no tests!" # put testing scripts here once they're written

after_success:
  - docker --version  # document the version travis is using
  - pip install --user awscli # install aws cli w/o sudo
  - export PATH=$PATH:$HOME/.local/bin # put aws in the path
  - eval $(aws ecr get-login --region us-east-1) #needs AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY envvars
  - docker build -t airflow-etl-worker .
  - docker tag airflow-etl-worker:latest $AWS_ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com/airflow-etl-worker:latest
  - docker push $AWS_ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com/airflow-etl-worker:latest